# Spring boot
---
## JPA
---
### dirty checking
```
영속성 컨테이너가 관리하는 엔티티의 상태를 감지해서
변경된 부분이 있다면 자동으로 트랜잭션이 끝나는 시점에 데이터베이스에 반영하는 기능
```
여기서 말하는 dirty는 `엔티티 데이터의 변경된 부분`을 뜻한다

---
### 조건
- `영속성 컨텍스트에서 관리되는 엔티티`      
영속석 컨텍스트는 `엔티티를 처음 조회`할 때 시작되며 이후 변경을 감지한다   
준영속 / 비영속 상태의 엔티티는 더티 체킹의 대상이 되지 못한다

- `Transaction이 커밋되었을 때`   
트랜잭션이 커밋되기 전까지 영속성 컨텍스트는 변경사항을 추적하기만 하고, DB에 반영하지는 않는다   
트랜잭션이 커밋될 때 영속성 컨텍스트는 엔티티의 변경된 상태를 DB에 반영한다

---
### Spring Data JPA의 더티체킹
`@Transactional`을 사용하여 더티 체킹을 수행 할 수 있다
하지만 JPA에서는 전체 필드를 업데이트하는 방식을 기본값으로 사용하기 때문에, 더티 체킹으로 생성되는 update 쿼리는 기본적으로 `모든 필드를 업데이트`한다

그래서 필요한 필드만 update하고 싶을 땐 `@DynamicUpdate`를 사용하면 된다

> 전체 필드를 업데이트하는 방식?  
-> 생성되는 쿼리가 같아 부트 실행시점에 미리 만들어서 재사용 가능하다   
-> 데이터베이스 입장에서 쿼리의 재사용이 가능하다
>
> 하지만 필드의 수가 많은 경우 전체 필드 업데이트 쿼리가 부담스러울 수도 있다

---