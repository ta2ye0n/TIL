# Dependency
---
## Dependency(의존성)
- 코드에서 두 모듈 간의 연결
- 객체지향언어에서는 두 클래스 간의 관계라고도 말함
- 일반적으로 둘 중 하나가 다른 하나를 어떤 용도를 위해 사용함
---
### Dependency가 위험한 이유
- 하나의 모듈이 바뀌면 의존한 다른 모듈까지 변경이 이루어지기 때문이다
- 테스트 가능한 어플을 만들 때 의존성이 있으면 유닛테스트 작성이 어렵다
    - 유닛테스트의 목적 자체가 다른 모듈로부터 독립적으로 테스트하는 것을 요구하기 때문이다 (Mock 객체로 대체 가능)
    > Mock : 실제 객체를 만들어 사용하기에 시간, 비용 등의 Cost가 높거나 혹은 객체 서로간의 의존성이 강해 구현하기 힘들 경우 가짜 객체를 만들어 사용하는 방법이다
---
### Dependency Injection(의존성 주입)
- 주입   
`내부가 아닌 외부에서 객체를 생성해서 넣어주는 것`
- 의존성 주입   
`의존성 주입은 하나의 패턴` : 의존성들을 인자들로 전달해준다면 모듈안에서 의존성들을 불러오거나 새로 만드는 것을 피할 수 있음

**DI의 장점**
- 모듈을 독립적으로 만들 수 있게 해줌
- 코드를 단순화 시켜줌
- 테스트에 용이
- 재사용성을 높여줌
- 종속적인 코드의 수 감소
- 종속성이 감소 > 코드변경/수정에 용이
- 가독성이 좋아짐(왜 사용하는지 파악하기가 수월해지므로)
- 결합도(coupling)는 낮추면서 유연성과 확장성은 향상 시킬 수 있음
- 객체간의 의존관계를 설정할 수 있음
- 객체 간의 의존 관계를 없애거나 줄일 수 있음
---
### 의존성주입이 필요한 이유
- Dependency가 위험한 이유를 해결하기 위해서 사용
- 'new'를 사용해 모듈 내에서 다른 모듈을 초기화하지 않으려면 객체 생성은 다른 곳에서 하고, 생성된 객체를 참조하면된다
- 의존성 주입은 Inbersion of Control 개념을 바탕으로 한다 클래스가 외부로부터 의존성을 가져야한다
- 클래스는 다른 클래스를 인스턴스화해야하지만, 구성 클래스에서 인스턴스를 가져와야한다
- Java 클래스가 new 연산자를 통해 다른 클래스의 인스턴스를 생성하면 해당 클래스와 독립적으로 테스트하고 사용할 수 없으며 이를 하도종속성이라고 한다
---
### 의존성 규칙
모든 소스코드 의존성은 반드시 `outer에서 inner`로, `저수준에서 고수준` 정책을 향해야한다
```
고수준 : 상위 수준의 개념, 추상화된 개념
    ex. 업무로직: 데이터를 저장한다, 견적을 계산한다

저수준 : 추상화된 개념을 실제 어떻게 구현할지에 대한 세부적인 개념
    ex. 세부사항: MySQL에 데이터를 저장한다, 선택 프로젝트의 견적을 계산한다
```

**의존성 규칙의 설명에 대한 추가 설명**
- 고수준의 모듈은 저수준의 모듈에 의존하면 안된다

- 추상화 된 것은 구체적인 것에 의존하면 안된다 

- 자주 변경되는 구현 클래스에 의존하면 안된다

- 일반적으로, 추상 클래스와 인터페이스는 자신에게서 유도된 구체적인 클래스보다 훨씬 덜 변한다

이러한 의존성 규칙을 지키기 위해서는 `What data crosses the boundaries`,`Crossing boundaries`와 같이 각 계층의 경계에서 어떤 것을 주의해야하는 지를 알아야 한다

- What Data crosses the boundaries   
`경계간의 데이터를 전달할 때 무엇을 전달해야하는가`
    - 단순하고, 독립된 형태의 데이터 구조 사용 필요
    - DB형식의 데이터 구조 또는 Framework에 종속적인 데이터 구조가 사용된다면 저수준의 데이터형식을 고수준에서 알아야하므로 의존성 규칙에 위반하게 됨

- Crossing boundaries   
제어의 흐름은 내부에서 외부로 향할 수 있는데 이는 의존성 규칙을 위배하게 되므로 `의존성 역전의 원칙`을 이용하여 이를 해결해야한다

---
### 클래스 외부에서 종속성을 제공하면 생기는 이점
- 클래스를 재사용 할 가능성을 높이고, 다른 클래스와 독립적으로 클래스를 테스트 할 수 있다
- 비즈니스 로직의 특정 구현이 아닌 클래스를 생성하는데 매우 효과적이다

---
### 의존성 주입(Dependency Injection) 방법
- Contructor Injection : 생성자 삽입
- Field Injection : 멤버 변수 삽입(비공개 안됨)
- Method Injection : 메소드 매게 변수 삽입

---
### Dependency Injector
- 모듈의 인스턴스를 제공하며 의존성을 주입하는 모듈

---
### 의존성 세팅
의존성 주입의 단점은 이용하려는 의존성들을 모두 미리 세팅, 구조화 해둬야한다는 것이다   
`의존성들을 모아두는 곳`을 흔히 `container`라고 부른다   
container를 일일이 세팅하는 것이 번거로울 때는 알아서 의존성을 찾고 가져와주는 `Awilix`나 `TypeDI`와 같은 라이브러리를 사용 할 수도 있다