# 컴퓨터 구조
---
## CPU 성능 향상 기법
---
### 명령어 병렬 처리 기법
```
명령어를 동시에 처리하여 CPU를 한시도 쉬지 않고 작동시키는 기법
```
빠른 CPU를 만들려면 높은 클럭 속도에 멀티코어, 멀티스레드를 지원하는 CPU를 만드는 것도 중요하지만, CPU가 놀지 않고 시간을 알뜰하게 쓰며 작동하게 만드는 것도 중요하다

---
### 명령어 파이프라인
명령어 파이프라인을 이해하려면 하나의 명령어가 처리되는 전체 과정을 비슷한 시간 간격으로 나누어 봐야 한다
명령어 처리 과정을 클럭 단위로 나누어 보면 일반적으로 아래와 같이 나눌 수 있다
```
1. 명령어 인출(Instruction Fetch)
2. 명령어 해석(Instruction Decode)
3. 명령어 실행(Execute Instruction)
4. 결과 저장(Write Back)
```

여기서 중요한 점은 같은 단계가 겹치지 않는다면 CPU는 `각 단계를 동시에 실행할 수 있다`는 것이다

![](https://velog.velcdn.com/images/thdgusrbek/post/8a211a86-07a9-4059-b88c-75cea61adedf/image.png)

그림처럼 CPU는 한 명령어를 인출하는 동안에 다른 명령어를 실행할 수 있고, 한 명령어가 실행되는 동안에 연산 결과를 저장할 수 있다

마치 공장 생산 라인과 같이 명령어들을 `명령어 파이프라인`에 넣고 동시에 처리하는 기법을 `명령어 파이프라이닝`이라고 한다

파이프라이닝이 높은 성능을 가져오기는 하지만, 특정 상황에서는 성능 향상에 실패하는 경우도 있다
이러한 상황을 `파이프라인 위험`이라고 부른다
파이프라인 위험에는 크게 `데이터 위험`, `제어 위험`, `구조적 위험`이 있다

#### 데이터 위험
```
명령어 간 데이터 의존성에 의해 발생
```
모든 명령어를 동시에 처리할 수는 없다
어떤 명령어는 이전 명령어를 끝까지 실행해야만 비로소 실행할 수 있는 경우가 있다

데이터 의존적인 두 명령어를 무작정 동시에 실행하려고 하면 파이프라인이 제대로 작동하지 않는 것을 `데이터 위험`이라고 한다

#### 제어 위험
```
주로 분기 등으로 인한 프로그램 카운터의 갑작스러운 변화에 의해 발생
```
프로그램 실행 흐름이 바뀌어 명령어가 실행되면서 프로그램 카운터 값에 갑작스러운 변화가 생긴다면 명령어 파이프라인에 미리 가지고 와서 처리중이었던 명령어들은 아무 쓸모가 없어지는 것을 `제어 위험`이라고 한다
> 참고로 이를 위해 사용하는 기술 중 하나가 `분기 예측`이다
분기 예측은 프로그램이 어디로 분기할지 미리 예측한 후 그 주소를 인출하는 기술이다

#### 구조적 위험
```
명령어들을 겹쳐 실행하는 과정에서 서로 다른 명령어가 동시에 ALU, 레지스터 등과 
같은 CPU 부품을 사용하려고 할 때 발생
```
구조적 위험은 `자원 위험`이라고도 부른다

---
### 슈퍼스칼라
```
CPU 내부에 여러 개의 명령어 파이프라인을 포함한 구조
```
슈퍼스칼라 구조로 명령어 처리가 가능한 CPU를 `슈퍼스칼라 프로세서` 또는 `슈퍼스칼라 CPU`라고 한다

슈퍼스칼라 프로세서는 이론적으로 파이프라인 개수에 비례하여 프로그램 처리 속도가 빨라진다
하지만 파이프라인 위험 등의 예상치 못한 문제가 있어 실제로는 반드시 파이프라인 개수에 비례하여 빨라지지는 않는다

여러개의 파이프라인을 이용하면 하나의 파이프라인을 사용할 때 보다 `데이터 위험을 피하기 까다로워` 고도로 설계되어야 한다

---
### 비순차적 명령어 처리
```
명령어들을 순차적으로 실행하지 않는 기법
```
> 보통 `OoOE(Out-of-order execution)`로 줄여 부른다

파이프라이닝, 슈퍼스칼라 기법은 모두 여러 명령어의 순차적인 처리를 상정한 방법이었다
하지만 파이프라인 위험과 같은 예상치 못한 문제들로 인해 이따금씩 명령어는 곧바로 처리되지 못하기도 한다
순서를 바꿔 실행할 때 순차적으로 명령어를 처리할 때보다 더 효율적으로 처리된다

이렇게 명령어를 순차적으로만 실행하지 않고 `순서를 바꿔 실행해도 무방한 명령어`를 먼저 실행하여 명령어 파이프라인이 멈추는 것을 방지하는 기법을 `비순차적 명령어 처리 기법`이라고 한다

하지만 아무 명령어나 순서를 바꿔서 수행할 수는 없다   
비순차적 명령어 처리가 가능한 CPU는 명령어들이 `어떤 명령어와 데이터 의존성을 가지고 있는지`, `순서를 바꿔 실행할 수 있는 명령어에는 어떤 것들이 있는지`를 판단할 수 있어야 한다