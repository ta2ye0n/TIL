# 컴퓨터 구조
---
## CPU의 작동원리
---
### 인터럽트
```
CPU의 정상적인 작업을 방해하는 신호
```

인터럽트의 종류에는 크게 동기 인터럽트와 비동기 인터럽트가 있다   
- `동기 인터럽트`   
CPU에 의해 발생하는 인터럽트   
CPU가 명령어들을 수행하다가 예상치 못한 상황에 마주쳤을 때, 가령 CPU가 실행하는 프로그래밍상의 오류와 같은 예외적인 상황에 마주쳤을 때 발생하는 인터럽트   
이런점에서 `예외`라고 부른다

- `비동기 인터럽트`   
주로 입출력장치에 의해 발생하는 인터럽트
    - CPU가 프린터와 같은 입출력장치에 입출력 작업을 부탁하면 작업을 끝낸 입출력장치가 CPU에 인터럽트를 보낸다
    - 키보드, 마우스와 같은 입출력장치가 어떠한 입력을 받아들였을 때 이를 처리하기 위해 CPU에 인터럽트를 보낸다

일반적으로 비동기 인터럽트를 인터럽트라 칭하기도 한다
> 하드웨어 인터럽트라고도 불린다

---
### 하드웨어 인터럽트
```
알림과 같은 인터럽트
```
CPU는 입출력 작업 도중에도 효율적으로 명령어를 처리하기 위해 이런 알림과 같은 하드웨어 인터럽트를 사용한다

**하드웨어 인터럽트 처리 순서**   
1. 입출력장치는 CPU에 `인터럽트 요청 신호`를 보낸다
2. CPU는 실행 사이클이 끝나고 명령어를 인출하기 전 항상 인터럽트 여부를 확인한다
3. CPU는 인터럽트 요청을 확인하고 `인터럽트 플래그`를 통해 현재 인터럽트를 받아들일 수 있는지 여부를 확인한다
4. 인터럽트를 받아들일 수 있다면 CPU는 지금까지의 작읍을 백업한다
5. CPU는 `인터럽트 벡터`를 참조하여 `인터럽트 서비스 루틴`을 실행한다
6. 인터럽트 서비스 루틴 실행이 끝나면 4번에서 백업해 둔 작업을 복구하여 실행을 재개한다

- `인트럽트 요청 신호` : 인트럽트 하기 전 보내는 요청   
CPU가 틴터럽트 요청을 수용하기 위해서는 프래그 레지스터의 `인터럽트 플래그`가 활성화되어 있어야한다
인터럽트 플래그는 하드웨어 인터럽트를 받아들일지, 무시할지 결정하는 플래그이다

CPU가 인터럽트 요청을 받아들이기로 했다면 CPU는 인터럽트 서비스 루틴이라는 프로그램을 실행한다
`인터럽트 서비스 루틴`은 인터럽트를 처리하기 위한 프로그램이다
`인터럽트 핸들러`라고도 불린다
어떤 인터럽트가 발생했을 때 해당 인터럽트를 어떻게 처리하고 작동해야 할지에 대한 정보로 이루어진 프로그램이다

인터럽트를 처리하는 방법은 입출력장치마다 다르므로 각기 다른 인터럽트 서비스 루틴을 가지고 있다
CPU는 수많은 인터럽트 서비스 루틴을 구분하기 위해 인터럽트 벡터를 사용한다
`인터럽트 벡터`는 인터럽트 서비스 루틴을 식별하기 위한 정보이다
인터럽트 벡터를 알면 인터럽트 서비스 루틴의 시작 주소를 알 수 있기 때문에 CPU는 인터럽트 벡터를 통해 특정 인터럽트 서비스 루틴을 처음부터 실행할 수 있다
> CPU는 하드웨어 인트럽트 요청을 보낸 대상으로부터 데이터 버스를 통해 인터럽트 벡터를 전달받는다